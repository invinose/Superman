function getApplicationPath() {
    var path = location.pathname;
    var index = path.indexOf("/Explorer");
    if (index > -1)
        return path.substr(0, index + 1);
    if (path.charAt(path.length - 1) != '/')
        path += '/';
    return path;
}

function selectFolder(folder) {
    if ($("#filelist").length == 0) {
        showListView(folder);
    }
    else {
        var grid = $("#filelist").data('tGrid');
        grid.rebind({ filePath: folder });
    }
    loadActionLinks(folder);
}

function showListView(path) {
    $.ajax({
        type: "POST",
        url: getApplicationPath() + "Explorer/FileList",
        data: { folderPath: path },
        cache: false,
        dataType: "html",
        success: function (data) {
            $('#searchlink').show();
            $('#clearlink').hide();

            $('#listpanel').html(data);
            $('#searchinput').val("");
            $('#searchinput').blur();
            $('#searchinput').focus();
        },
        error: function (req, status, error) {
            alert("switch to normal view failed!");
        }
    });
}

function loadActionLinks(file, list) {
    var path = getApplicationPath();
    $.ajax({
        type: "POST",
        url: path + "Explorer/LoadActionLinks",
        data: { path: file, list: list },
        cache: false,
        dataType: "html",
        success: function (data) {
            $('#commands').html(data);
        },
        error: function (req, status, error) {

            alert("failed.");
        }
    });
}

$(function () {

    $('#searchbox input')
           .focus(function () {
               $('#searchbox label').hide();
           })
            .blur(function () {
                if (this.value == "")
                    $('#searchbox label').show();
            });
});